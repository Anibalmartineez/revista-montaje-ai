<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Resultado diagnóstico flexo</title>
  <style>
    #contenedor-imagen {
      position: relative;
      display: inline-block;
    }
    .imagen-analizada {
      width: 100%;
      max-width: 800px;
      display: block;
      margin: auto;
      position: relative;
    }
    .botones {
      text-align: center;
      margin-top: 20px;
    }
    .botones .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #0056b3;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
    }
    #contenedor-imagen div {
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div id="contenedor-imagen" style="position: relative;">
    <img src="{{ url_for('static', filename=imagen_path_web) }}" id="imagen-diagnostico" class="imagen-analizada" />
  </div>
  <script>
    const overlayData = {{ overlay|tojson }};
    const contenedor = document.getElementById("contenedor-imagen");
    const imagen = document.getElementById("imagen-diagnostico");

    function dibujarOverlays() {
      const scaleX = imagen.clientWidth / imagen.naturalWidth;
      const scaleY = imagen.clientHeight / imagen.naturalHeight;
      overlayData.forEach(item => {
        const box = document.createElement("div");
        box.style.position = "absolute";
        box.style.border = "2px solid red";
        box.style.left = (item.bbox[0] * scaleX) + "px";
        box.style.top = (item.bbox[1] * scaleY) + "px";
        box.style.width = ((item.bbox[2] - item.bbox[0]) * scaleX) + "px";
        box.style.height = ((item.bbox[3] - item.bbox[1]) * scaleY) + "px";
        box.title = (item.tipo || "") + ": " + (item.etiqueta || "");
        box.style.pointerEvents = "none";
        contenedor.appendChild(box);
      });
    }

    if (imagen.complete) {
      dibujarOverlays();
    } else {
      imagen.onload = dibujarOverlays;
    }
  </script>
  <div>{{ resumen|safe }}</div>
  <div class="botones">
    <a href="{{ url_for('routes.revision_flexo') }}" class="btn">⬅ Volver a revisar otro diseño</a>
  </div>
</body>
</html>
